# SETTINGS ===============================================================================
set -g default-terminal "screen-256color"
set -g terminal-overrides ",xterm-256color:Tc"

set -g history-limit 10000

set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on

setw -g monitor-activity on
set -g visual-activity off

set-option -g set-titles on
set-option -g set-titles-string 'tmux: #S - #W'

set-option -g allow-rename off
# set-window-option -g automatic-rename off

# BINDINGS ===============================================================================
# unbind C-b
# set -g prefix C-a

set -s escape-time 0
set -g xterm-keys on
setw -g mode-keys vi
set-option -g status-keys vi

set -g mouse on

bind-key -n M-d detach

# COMMANDS -------------------------------------------------------------------------------
bind-key -n M-\; command-prompt

set -s command-alias[20] rc='source-file "~/.tmux.conf"; display "Reloaded tmux config"'
set -s command-alias[21] nw='new-window'
set -s command-alias[22] vs='split-window -h -c "#{pane_current_path}"'
set -s command-alias[23] sp='split-window -v -c "#{pane_current_path}"'
set -s command-alias[24] q='confirm-before kill-pane'
set -s command-alias[25] qw='confirm-before kill-window'
set -s command-alias[26] qa='confirm-before kill-session'
set -s command-alias[27] q!='kill-pane'
set -s command-alias[28] qw!='kill-window'
set -s command-alias[29] qa!='kill-session'
set -s command-alias[30] rw='rename-window'
set -s command-alias[31] rs='rename-session'

# MENUS ----------------------------------------------------------------------------------
# Pane menu
bind-key -n M-, display-menu \
    -T "#[align=centre]#{pane_index} (#{pane_id})" -x P -y P \
    'Kill' X 'kill-pane' \
    'Respawn' R 'respawn-pane -k' \
    '#{?pane_marked,Unmark,Mark}' m 'select-pane -m' \
    '#{?window_zoomed_flag,Unzoom,Zoom}' z 'resize-pane -Z' \
    '#{?pane_marked_set,,-}Swap Marked' s 'swap-pane' \
    'Swap Left'  h 'select-pane -L; swap-pane -t "#{pane_index}"' \
    'Swap Up'    k 'select-pane -U; swap-pane -t "#{pane_index}"' \
    'Swap Down'  j 'select-pane -D; swap-pane -t "#{pane_index}"' \
    'Swap Right' l 'select-pane -R; swap-pane -t "#{pane_index}"' \
    'Horizontal Split' s "split-window -v" \
    'Vertical Split'   v "split-window -h"

# Window menu
bind-key -n M-. display-menu \
    -T "#[align=centre]#{window_index}:#{window_name}" -x W -y S \
    'Swap Left'  h 'swap-window -t:-1; select-window -t:-1' \
    'Swap Right' l 'swap-window -t:+1; select-window -t:+1' \
    '#{?pane_marked_set,,-}Swap Marked' s 'swap-window' \
    'Kill' X 'kill-window' \
    'Respawn' R 'respawn-window -k' \
    "#{?pane_marked,Unmark,Mark}" m 'select-pane -m' \
    'Rename' r "command-prompt -I \"#W\" \"rename-window -- '%%'\"" \
    'New After'  w 'new-window -a' \
    'New At End' W 'new-window'

# Session menu
bind-key -n M-/ display-menu \
    -T "#[align=centre]#{session_name} (#{session_id})" -y S \
    'Reload Config' R 'source-file "~/.tmux.conf"; display "Reloaded tmux config"' \
    'Select Window' w 'choose-tree -Zw' \
    'Command Line' '\;' 'command-prompt' \
    'Kill' X 'kill-session' \
    'Rename' r "command-prompt -I \"#S\" \"rename-session -- '%%'\"" \
    'Detach' d 'detach'

# WINDOWS --------------------------------------------------------------------------------
bind-key -n M-c new-window -c "#{pane_current_path}"
bind-key -n M-n select-window -t :+
bind-key -n M-p select-window -t :-
bind-key -n M-1 select-window -t :1
bind-key -n M-2 select-window -t :2
bind-key -n M-3 select-window -t :3
bind-key -n M-4 select-window -t :4
bind-key -n M-5 select-window -t :5
bind-key -n M-6 select-window -t :6
bind-key -n M-7 select-window -t :7
bind-key -n M-8 select-window -t :8
bind-key -n M-9 select-window -t :9
bind-key -n M-0 select-window -t :10
bind-key -n M-space last-window

# PANES ----------------------------------------------------------------------------------
bind-key -n M-v split-window -h -c "#{pane_current_path}"
bind-key -n M-s split-window -v -c "#{pane_current_path}"
bind-key -n M-h select-pane -L
bind-key -n M-j select-pane -D
bind-key -n M-k select-pane -U
bind-key -n M-l select-pane -R
bind-key -n M-H run-shell 'tmux select-pane -L; tmux swap-pane -t "#{pane_index}"'
bind-key -n M-J run-shell 'tmux select-pane -D; tmux swap-pane -t "#{pane_index}"'
bind-key -n M-K run-shell 'tmux select-pane -U; tmux swap-pane -t "#{pane_index}"'
bind-key -n M-L run-shell 'tmux select-pane -R; tmux swap-pane -t "#{pane_index}"'

bind-key -n M-f resize-pane -Z
bind-key -n M-C clear-history

# COPY MODE ------------------------------------------------------------------------------
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'y' send -X copy-selection-and-cancel

# THEME ----------------------------------------------------------------------------------
set -g status-interval 5
run-shell ~/.config/tmux/onedark.tmux

# PLUGINS --------------------------------------------------------------------------------
run-shell ~/.config/tmux/extrakto/extrakto.tmux
